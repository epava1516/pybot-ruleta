services:
  bot:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: roulette_bot_telegram
    env_file: .env
    environment:
      MODE: ${MODE}
      DOMAIN: ${DOMAIN}
      PUBLIC_URL: ${PUBLIC_URL}
      TOKEN: ${TOKEN}
      WEBHOOK_SECRET: ${WEBHOOK_SECRET}
      DATA_FILE: ${DATA_FILE}
      DEFAULT_WINDOW: ${DEFAULT_WINDOW}
      DEFAULT_DATA_LIMIT: ${DEFAULT_DATA_LIMIT}
      ENVIRONMENT: ${ENVIRONMENT}
      LOG_LEVEL: ${LOG_LEVEL}
      WEB_HOST: ${WEB_HOST}
      WEB_PORT: ${WEB_PORT}
      REDIRECT_URL: ${REDIRECT_URL}
      RESTRICT_TO_TELEGRAM: ${RESTRICT_TO_TELEGRAM}
      GATE_STRICT: ${GATE_STRICT}
    volumes:
      - ./data:/app/data
    ports:
      - "${WEB_PORT:-8080}:${WEB_PORT:-8080}"
    healthcheck:
      test: ["CMD-SHELL", "if [ \"$${MODE:-polling}\" != \"webhook\" ]; then exit 0; fi; wget -qO- http://127.0.0.1:$${WEB_PORT:-8080}/health || exit 1"]
      interval: 20s
      timeout: 3s
      retries: 5
    restart: unless-stopped
